<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
        Examen 
    </title>
    <style type="text/css">
        canvas {
           
            margin: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            
        }
        body {
            background-color: black;
        }
        
    </style>

</head>

<body>
    <canvas id="miexam" width="500" height="500"></canvas> 


    <script type="text/javascript">
        var cv = null;
        var ctx = null;
        var player = null;

        var Sx = 20; //posicion x del jugador
        var Sy = 100; // posicion y del jugador
        var score = 0;
        
        var wall = new Array(10);
        var wallRomp = new Array(5);
        let imgplayer = new Image();
        let imgpared = new Image();
        let imgparedromp = new Image();
        let imgBreak = new Image();
        let terreno = [];
        var pause = false;

        imgplayer.onload = function () {
                update();
            };

        imgpared.onload = function () {
                update();
            };

        imgparedromp.onload = function () {
                update();
            };   
        imgBreak.onload = function () {
                update();
            };  

        function start() {
            cv = document.getElementById('miexam');
            ctx = cv.getContext('2d');

            cwidth = cv.width;
            cheight = cv.height;

            player = new cuadrado(Sx, Sy, 30, 30);

            wall = new cuadrado(100, 100, 40, 40);

            imgplayer.src = 'player.png';
            imgpared.src = 'pared.png';
            imgparedromp.src = 'paredromp.png'
            imgBreak.src = 'break.png'

            paint();
        }

        function paint() {

            window.requestAnimationFrame(paint)


            ctx.fillStyle = "cyan";

            ctx.fillRect(0, 0, cwidth, cheight);

            ctx.fillStyle = "#FCE37D";
            ctx.fillRect(0, 100, cwidth, 900);


            player.dibujar(ctx);
            wall.dibujar(ctx);

            
            ctx.drawImage(imgpared, wall.x-40, wall.y, 40, 40);
            ctx.drawImage(imgplayer, cwidth/2, player.y, 30, 30);
            ctx.drawImage(imgBreak, wall.x, wall.y, 40, 40);
            //ctx.drawImage(imgBreak, wall.x, wall.y, 40, 40);

            ctx.fillStyle = "black";
            ctx.fillText("Score: " + score, 20, 10);

            terreno.push(new Cuadrado(0,0,50,10,"#F7DC6F"));


            if (pause) {
                ctx.fillStyle = "rgba(0,0,0,0.5)";
                ctx.fillRect(0, 0, 500, 500);

                ctx.fillStyle = "white";
                ctx.fillText("pause", 250, 250);

            } else {

                update();
            }

        }

        function update() {
            if (player.se_tocan(wall)) {
                if (direction == 'left') {
                    player.x += 40;
                }

                if (direction == 'right') {
                    player.x -= 40;
                }

                if (direction == 'up') {
                    player.y += 40;
                }

                if (direction == 'down') {
                    player.y -= 40;
                }
            }
        }

        window.addEventListener('load', start)

        window.requestAnimationFrame = (function () {
            return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                function (callback) {
                    window.setTimeout(callback, 17);
                };
        }());

        function cuadrado(x, y, w, h, c) {
            this.x = x;
            this.y = y;
            this.w = w;
            this.h = h;
            this.c = c;

            this.se_tocan = function (target) {
                if (this.x < target.x + target.w &&
                    this.x + this.w > target.x &&
                    this.y < target.y + target.h &&
                    this.y + this.h > target.y) {
                    return true;
                }
            };

            this.dibujar = function (ctx) {
                ctx.fillStyle = this.c;
                ctx.fillRect(this.x, this.y, this.w, this.h);
                //ctx.strokeRect(this.x, this.y, this.w, this.h);
            }
        }

        document.addEventListener('keydown', function (e) {
            console.log(e)
            //arriba
            if (e.which == 87 || e.which == 38) {
                direction = 'up';
                Sy -= 40;
                player.y -= 40;
            }
            //abajo
            if (e.which == 83 || e.which == 40) {
                direction = 'down';
                Sy += 40;
                player.y += 40;
            }
            //izquierda
            if (e.which == 65 || e.which == 37) {
                direction = 'left';
                Sx -= 40;
                player.x -= 40;
            }
            //derecha
            if (e.which == 68 || e.which == 39) {
                direction = 'right';
                Sx += 40;
                player.x += 40;
            }

            //bomba
            if (e.which == 'intro' || 13) {
                //agregar bomba
                ctx.fillStyle = "orange";
                ctx.fillText(player.x+1,10, 10);
            }
            //paint();

            //pausa
            if (e.which == 32) {
                //pause = true;
                pause = (pause) ? false : true;
            }
        })
    </script>

</body>

</html>